---
id: Agent
title: Agents for File Capture
displayed_sidebar: webUiSidebar
---

import { PlusOutlined, 
         SelectOutlined,
         DiffOutlined
       } from '@ant-design/icons';

The Ganymede Agent is software installed on lab instrument PCs that systematically capture and process instrument data.  Agents can

- filter and designate how to process data
- upload files into Ganymede Cloud
- initiate data processing pipelines, which can be based
  - upon specific files being written to the local machine by the instrument
  - upon specific files being written to a cloud storage bucket
  - on a scheduled cadence

Users specify which of the above actions to take by configuring the Agent in the Ganymede app.  Doing so creates Linux and Windows executables corresponding to the specified configuration, which users then install on instrument PCs.  Once installed, users can optionally configure a Python script associated with the Agent to process captured files on the instrument PC.

## Building an Agent

To create a new Agent, click the <div className="button system_button"><PlusOutlined /> New Agent</div> button on the upper-left corner of the Connections page.

<img alt="Agent Front page" src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Connections_Front_Page20230626.png" />
&nbsp;

The left side of the configuration panel is used to specify the Agent's configuration; Agent parameters relevant to selected configuration are displayed.  The right side of the configuration panel shows the default Python script associated with the Agent, which can be modified after Agent installation.

<div class="text--center">
  <img alt="New Agent configuration" 
      src="https://ganymede-bio.mo.cloudinary.net/agent/New_Agent_Configuration20230626.png"
  />
</div>
&nbsp;

After filling out this form, click <div className="button darkblue_button_icon">Create</div> to start building Windows and Linux executables.  When the build is complete, the Agent (i.e. - the configured executables) can be downloaded from the Ganymede application by selecting the corresponding Agent from the Connections tab.

:::tip

Typically, building an executable takes around 10 minutes to complete.

:::

### Build Config: Name

The Name input is used to specify the display name for the Agent.  Once the identification is specified, an agent ID is generated from the display name which uniquely identifies the Agent. The Agent ID is locked for a given agent after generation, though its display name can be changed.

### Build Config: Configuration

The Agent can take on the following configurations, which are described in detail below:

- **Watch for files locally then run flow**: Monitor specified directory on the local file system for files to process and execute upon observing new files matching specified pattern
- **Set a cron job to run flows periodically**: Periodically observe local directory for files and deliver those files to Ganymede Cloud for processing
- **Watch for files locally and upload**: Monitor specified directory on the local file system and upload files to Ganymede Cloud upon observation.
- **Watch for flow outputs then save locally**: Monitor specified directory in Ganymede Cloud Storage for new files, and capture + process files on local instrument PC upon observation
- **Load local files into Ganymede with a custom filter**: Send specified files on local instrument PC and process on Ganymede Cloud

#### Watch for files locally then run flow: Monitor specified directory on the local file system for files to process and execute upon observing new files matching specified pattern
  - `Check Period`: Frequency with which Agent will poll local directory for new files
  - `Glob to Parameter Mapping`: A set of input pairs; the left member of the input pair is a [glob pattern](https://en.wikipedia.org/wiki/Glob_(programming)) to match files against, and the member on the right is the input parameter associated with the flow to associated captured files with.  Multiple pairs can be specified, directing files matching different glob patterns to different nodes.
  
    For example, if the instrument outputs an XML file called "lc_metadata<YYYYMMDD\>.abc" which is to be ingested by [XML_Read node](../nodes/File/XML_Read.md) called "Ingest_LC_Metadata", an appropriate configuration would be "lc_metadata*.abc" for the left input box and "Ingest_LC_Metadata.xml" for the right node.

<div class="text--center">
  <img alt="Agent configuration - File Watcher" 
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_File_Watcher_Config20230605.png"
      width="500" />
</div>
&nbsp;

:::info Viewing flow input parameters

Input parameters to populate on a Flow can be viewed by selecting "Run Flow" for Action and then selecting the desired flow from the dropdown menu.

<div class="text--center">
  <img alt="Example agent configuration - File Watcher with Flow Run" 
      src="https://ganymede-bio.mo.cloudinary.net/agent/Example_File_Watcher_Config20230605.png"
      width="500" />
</div>

:::

#### Example use case for File Watcher mode

An instrument outputs files to a directory each time it completes a run, which serve as inputs for a Ganymede flow. 

- **Cron**: Run Action on a pre-set schedule

<div class="text--center">
  <img alt="Agent configuration - Cron" 
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Cron_Config20230605.png"
      width="500" />
</div>
&nbsp;

#### Example use case for Cron mode

A local script (the Normalizer) must be run once a day to poll and capture updates from telemetry devices for further processing in a Ganymede flow.

- **Cloud Watcher**: Monitor specified directory in Ganymede Cloud Storage for new files, and execute upon observing new files matching specified pattern

#### Example use case for Cloud Watcher mode

Output data from a Ganymede flow is retrieved and cross-checked against instrument data to verify that the lab machine is producing expected results.

- **Manual**: Upon Agent launch, the Agent code executes once and then exits.

### Build Config: Action

Actions are executed after the Listener and Normalizer (user-defined Python) have completed.

- **Upload File**: Uploads file(s) to Ganymede Cloud Storage in the agent directory.  This data can be found in the File Explorer under "/_agents/<agent id\>/"

#### Example use case for Upload File Action

Files output by an instrument are stored in Ganymede as a source of truth.

- **Run Flow**: Run a flow based on the input provided and as mediated by the flow input requirements. 

#### Example use case for Run Flow Action

An instrument outputs files to a directory as it completes runs, which are processed in Ganymede Cloud. 

- **No-Op**: Complete Agent execution without performing an Action

## Installing Agents

To install an Agent, open the Ganymede application in a browser window and navigate to the Connection tab in the left sidebar.  Select the desired Agent by name and download the relevant Windows/Linux installation file.

:::note

Both Linux and Windows versions of the Agent are built using x86_64 architecture.  The Linux executable is Ubuntu-based and the Windows executable is Windows Server 2022.

:::

### Windows Installation

After downloading the Agent, launch the installation file to complete Agent configuration

<div class="text--center">
  <img alt="Windows Agent installation"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Windows_Setup20230605.png"
      width="500" />
</div>
&nbsp;

- **Connection name** is the name seen by users in the instrument computer and in the Ganymede UI
- **Variable definitions** are strings in the format "var_name=var_value", which allows users to set context variables to be used in the Normalizer
- **Label** is a string that can be used to identify and group connections within Ganymede.  The label is visible in the Connections UI

For File Watcher agents, the directory watched is specified in the Additional Params input box:

```shell
# note that forward slashes must be used to specify path
-v "input_path=/absolute/path"
```

### Linux Installation

TODO: Add Linux installation instructions using systemd

TODO: Describe how to set up outbound traffic firewalls requirements

## Configuring the Normalizer

To modify user-defined code executed by the Agent, select the Agent in the Ganymede app and then click on the <div className="button gray_button"><SelectOutlined />Code</div> button.  Doing so opens a notebook for the user to modify the Normalizer, which is executed after the Trigger and before the Action.

<div class="text--center">
  <img alt="Agent update configuration"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Update_Zoomed_In20230605.png"
      width="500" />
</div>
&nbsp;

<div class="text--center">
  <img alt="Agent Normalizer"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Normalizer_ZoomedIn20230605.png"
      width="800" />
</div>
&nbsp;

Previously built agents remain available for download in Ganymede.

## Maintaining Agents

### Viewing Logs

Logs can be found on the Logs tab for each Agent.  These logs contain status check-ins and information regarding the Agent's trigger.

<div class="text--center">
  <img alt="Agent logs"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Logs_Page20230615.png" 
      width="500"
      />
</div>


### Monitoring Agent Connections

Agents with Action types of Upload File and Run Flow communicate with Ganymede Cloud to upload files and run flows, respectively.  These communications can be monitored by observing status updates and logs in the Ganymede web app UI.

The Connections page shows an overview of all connections that have ever been made and their latest status in addition to other metadata made available from their last status ping.

<div class="text--center">
  <img alt="Agent Status"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Status20230605.png"
      width="400" />
</div>
&nbsp;

The Agent page displays a list of all connections instantiated from a specific Agent. This provides the user quick and easy access to the running executables associated with a specific Agent configuration.

<div class="text--center">
  <img alt="Agent Connection Status"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Connection_Status20230605.png"
      width="400" />
</div>
&nbsp;

### Updating Agents

To modify Agent settings after creation, select the desired Agent in the Connections tab to update the Agent.  Upon clicking <div className="button blue_button">Update</div>, the Agent will be built and then made available for download.

<div class="text--center">
  <img alt="Agent update configuration"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Update20230605.png"
      width="500" />
</div>
&nbsp;

Agents can also be archived or disabled.  Archived Agents cannot be updated, but can still communicate with Ganymede Cloud.  Disabled agents cannot be updated or communicate with Ganymede Cloud.

:::note

Listener and Action types cannot be updated once an Agent's configuration is set.

:::

### Viewing Build History

Each iteration of Agent build can be viewed in the History tab of the agent. This view provides context for each change, either in the form of a log of the configuration change or through a custom commit message from the Agent notebook.

<div class="text--center">
  <img alt="Agent build history"
       src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Build_History20230605.png" 
       width="800"
  />
</div>
&nbsp;

Configuration differences between two agent builds can be viewed for audit or debugging purposes by clicking <div className="keystroke blue_keystroke"><DiffOutlined /></div> button.

<div class="text--center">
  <img alt="Agent build history detail"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Build_History_Detail20230605.png" 
      width="800"
      />
</div>

### Uninstalling Agents

#### Windows

The Agent can be uninstalled and associated service removed through the “Add or Remove Programs” panel from the Control Panel.

<div class="text--center">
  <img alt="Agent uninstall"
      src="https://ganymede-bio.mo.cloudinary.net/agent/Agent_Uninstall20230615.png" 
      width="500"
      />
</div>

TODO: note that the service is not removed from the system upon uninstallation.

After uninstalling the Agent, the Ganymede folder will remain in the Program Files directory.  This folder can be deleted if desired.

#### Linux

TODO: add instructions for uninstalling Linux agents

## Agent Glossary

- **Agent**: A combination of a Listener, Processor, and Action configuration to move data from a remote user device into Ganymede. It can be helpful to think of an Agent as a class which is instantiated for each new connection. 
- **Agent Connection**: A running instance of the agent on a unique machine that has previously or is currently connected to Ganymede. The instance is listening for the configured trigger and will perform the Action configured for the Agent.
- **Listener**: A process that watches for new files and initiates the rest of the agent pipeline based on a preconfigured change or event.
- **Normalizer**: User-defined Python code that normalizes data captured by a Listener
- **Action**: An interaction with Ganymede's cloud or application that will move data output from the Normalizer into the specified location.